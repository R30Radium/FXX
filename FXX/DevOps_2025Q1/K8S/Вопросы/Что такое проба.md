
**Проба (probe)** в Kubernetes — это механизм проверки состояния приложения внутри контейнера. Kubernetes использует пробы, чтобы понять, как взаимодействовать с контейнером: нужно ли его перезапустить, готов ли он принимать трафик или завершил ли он запуск.

---

### **Как это работает:**
Kubernetes периодически выполняет проверку (например, HTTP-запрос, команду в контейнере или проверку TCP-порта) и анализирует результат:
- Если проба **успешна**, Kubernetes считает, что контейнер работает корректно.
- Если проба **неуспешна**, Kubernetes предпринимает действия в зависимости от типа пробы (например, перезапускает контейнер или временно исключает его из балансировки нагрузки).

---

### **Типы проб:**
1. **HTTP-запрос:** Kubernetes отправляет HTTP-запрос по указанному пути и порту.
   ```yaml
   httpGet:
     path: /healthz
     port: 8080
   ```
2. **Выполнение команды:** Kubernetes выполняет команду внутри контейнера и проверяет её код возврата (0 — успех, иначе — ошибка).
   ```yaml
   exec:
     command:
       - cat
       - /app/healthy
   ```
3. **TCP-соединение:** Kubernetes проверяет, открыт ли указанный порт.
   ```yaml
   tcpSocket:
     port: 8080
   ```

---

### **Основные параметры проб:**
- **initialDelaySeconds:** Задержка перед первой проверкой (например, чтобы дать приложению время на запуск).
- **periodSeconds:** Как часто выполнять проверку.
- **timeoutSeconds:** Время ожидания ответа.
- **successThreshold:** Количество успешных проверок для успешного результата.
- **failureThreshold:** Количество неудачных проверок для признания пробы неуспешной.

---

### **Пример пробы:**
```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 3
```

---

### **Зачем нужны пробы?**
- **Надежность:** Kubernetes автоматически перезапускает "упавшие" контейнеры.
- **Гибкость:** Приложение может сообщать о своей готовности или неготовности принимать трафик.
- **Стабильность:** Исключение из балансировки нагрузки контейнеров, которые временно не готовы.

Пробы — это ключевой инструмент для обеспечения отказоустойчивости и стабильности приложений в Kubernetes.